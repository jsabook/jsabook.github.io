<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Qier&#39;s blog</title>
  <icon>http://yoursite.com/icon.png</icon>
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://yoursite.com/"/>
  <updated>2022-03-10T02:34:11.629Z</updated>
  <id>http://yoursite.com/</id>
  
  <author>
    <name>qier</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Summary</title>
    <link href="http://yoursite.com/2022/03/10/Summary/"/>
    <id>http://yoursite.com/2022/03/10/Summary/</id>
    <published>2022-03-10T02:34:11.629Z</published>
    <updated>2022-03-10T02:34:11.629Z</updated>
    
    <summary type="html">
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>UseOpenVPN</title>
    <link href="http://yoursite.com/2022/03/10/UseOpenVPN/"/>
    <id>http://yoursite.com/2022/03/10/UseOpenVPN/</id>
    <published>2022-03-10T02:34:11.629Z</published>
    <updated>2022-03-10T02:34:11.629Z</updated>
    
    <content type="html"><![CDATA[<h1 id="OpenVPN使用手册"><a href="#OpenVPN使用手册" class="headerlink" title="OpenVPN使用手册"></a>OpenVPN使用手册</h1><p>使用账号密码认证来配置，可以轻松实现多人登录使用VPN。OpenVPN所有的通信都基于一个单一的IP端口。OpenVPN 是一个开源的应用程序，它允许您通过公共互联网创建一个安全的专用网络。OpenVPN 实现一个虚拟专用网（VPN）来创建一个安全连接。OpenVPN 使用 OpenSSL 库提供加密，它提供了几种身份验证机制，如基于证书的、预共享密钥和用户名/密码身份验证。</p><h1 id="1-软件版本"><a href="#1-软件版本" class="headerlink" title="1. 软件版本"></a>1. 软件版本</h1><ul><li>Centos - 7.9</li><li>easy-rsa - 3.0.8</li><li>OpenVPN - 2.4.7</li></ul><h1 id="2-安装"><a href="#2-安装" class="headerlink" title="2. 安装"></a>2. 安装</h1><p>本文使用yum来安装openvpn，openvpn及其依赖的一些包在epel源上，首先先安装epel源。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#更新yum</span></span><br><span class="line">yum update -y</span><br><span class="line"><span class="comment">#安装epel源</span></span><br><span class="line">yum install -y epel-release</span><br><span class="line"><span class="comment">#安装依赖包</span></span><br><span class="line">yum install -y openssl lzo pam openssl-devel lzo-devel pam-devel</span><br><span class="line">yum install -y easy-rsa</span><br><span class="line"><span class="comment">#安装openvpn</span></span><br><span class="line">yum install -y openvpn</span><br></pre></td></tr></table></figure><h1 id="3-配置"><a href="#3-配置" class="headerlink" title="3. 配置"></a>3. 配置</h1><p>已经安装好了openvpn了，下面我们对openvpn进行配置。</p><h3 id="3-1-连接方式"><a href="#3-1-连接方式" class="headerlink" title="3.1 连接方式"></a>3.1 连接方式</h3><p>使用路由方式连接，确定私有子网：</p><p>Server 与 Client 的VPN通道子网，不要与已有环境的网络冲突即可。</p><p>默认：10.8.0.0/16</p><h3 id="3-2-配置证书密钥"><a href="#3-2-配置证书密钥" class="headerlink" title="3.2 配置证书密钥"></a>3.2 配置证书密钥</h3><p>我们通过yum方式安装的 easy-rsa 版本是3.0.8，直接从安装路径copy一份工具出来。这里用默认的 easy-rsa 3.0.8 来配置生成证书密钥。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#复制easy-rsa工具</span></span><br><span class="line">cp -rf /usr/share/easy-rsa/3.0.8 /etc/openvpn/server/easy-rsa</span><br><span class="line"><span class="built_in">cd</span> /etc/openvpn/server/easy-rsa</span><br><span class="line"><span class="comment">#生成证书密钥</span></span><br><span class="line">./easyrsa init-pki</span><br><span class="line">./easyrsa build-ca nopass</span><br><span class="line">./easyrsa build-server-full server nopass</span><br><span class="line"><span class="comment">#下面这步可能要几分钟</span></span><br><span class="line">./easyrsa gen-dh</span><br><span class="line">openvpn --genkey --secret ta.key  <span class="comment">#TLS-auth密钥</span></span><br></pre></td></tr></table></figure><h3 id="3-3-配置Server端"><a href="#3-3-配置Server端" class="headerlink" title="3.3 配置Server端"></a>3.3 配置Server端</h3><h4 id="3-3-1-创建使用的目录"><a href="#3-3-1-创建使用的目录" class="headerlink" title="3.3.1 创建使用的目录"></a>3.3.1 创建使用的目录</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 日志存放目录</span></span><br><span class="line">mkdir -p /var/<span class="built_in">log</span>/openvpn/</span><br><span class="line"><span class="comment"># 用户管理目录</span></span><br><span class="line">mkdir -p /etc/openvpn/server/user</span><br><span class="line"><span class="comment"># 配置权限</span></span><br><span class="line">chown -R openvpn:openvpn /var/<span class="built_in">log</span>/openvpn</span><br></pre></td></tr></table></figure><h4 id="3-3-2-创建Server配置文件"><a href="#3-3-2-创建Server配置文件" class="headerlink" title="3.3.2 创建Server配置文件"></a>3.3.2 创建Server配置文件</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">#编辑server.conf文件</span><br><span class="line">yum install -y vim</span><br><span class="line">vim /etc/openvpn/server/server.conf</span><br><span class="line">    </span><br><span class="line">#服务器openvpn基本配置，写入以下内容</span><br><span class="line">    </span><br><span class="line"># 配置权限</span><br><span class="line">port <span class="number">1194</span>  #监听端口号</span><br><span class="line">proto tcp   #服务端用的协议，可以为tcp/udp</span><br><span class="line">dev tun   #指定创建的通信隧道类型，可选tun或tap</span><br><span class="line">user openvpn</span><br><span class="line">group openvpn</span><br><span class="line"></span><br><span class="line">#配置证书信息</span><br><span class="line">ca /etc/openvpn/server/easy-rsa/pki/ca.crt #CA 根证书路径</span><br><span class="line">cert /etc/openvpn/server/easy-rsa/pki/issued/server.crt  <span class="meta">#open VPN 服务器证书路径</span></span><br><span class="line">key /etc/openvpn/server/easy-rsa/pki/<span class="keyword">private</span>/server.key  <span class="meta">#open VPN 服务器密钥路径</span></span><br><span class="line">dh /etc/openvpn/server/easy-rsa/pki/dh.pem #Diffie-Hellman 算法密钥文件路径</span><br><span class="line">tls-auth /etc/openvpn/server/easy-rsa/ta.key <span class="number">0</span> </span><br><span class="line">#  开启TLS-auth，使用防御攻击。服务器端的第二个参数值为<span class="number">0</span>，客户端的为</span><br><span class="line"></span><br><span class="line">#配置账号密码的认证方式</span><br><span class="line">auth-user-pass-verify /etc/openvpn/server/user/checkpsw.sh via-env</span><br><span class="line">script-security <span class="number">3</span></span><br><span class="line">verify-client-cert none</span><br><span class="line">username-as-common-name</span><br><span class="line">client-to-client  #允许客户端与客户端相连接，默认情况下客户端只能与服务器相连接</span><br><span class="line">duplicate-cn</span><br><span class="line"></span><br><span class="line">#配置网络信息</span><br><span class="line">server <span class="number">10.8</span><span class="number">.0</span><span class="number">.0</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line"># 该网段为 open VPN 虚拟网卡网段，不要和内网网段冲突即可。open VPN 默认为 <span class="number">10.8</span><span class="number">.0</span><span class="number">.0</span>/<span class="number">24</span></span><br><span class="line">push <span class="string">"dhcp-option DNS 223.5.5.5"</span></span><br><span class="line">push <span class="string">"dhcp-option DNS 114.114.114.114"</span></span><br><span class="line">push <span class="string">"route 192.168.1.0 255.255.255.0"</span> #修改网段为内网网段</span><br><span class="line">push <span class="string">"route 192.168.2.0 255.255.255.0"</span> #同上</span><br><span class="line"></span><br><span class="line">compress lzo  #使用lzo压缩的通讯,服务端和客户端都必须配置</span><br><span class="line">cipher AES<span class="number">-256</span>-GCM  #加密认证算法</span><br><span class="line">keepalive <span class="number">10</span> <span class="number">120</span>  #每<span class="number">10</span>秒ping一次，连接超时时间设为<span class="number">120</span>秒</span><br><span class="line">persist-key  #重启时仍保留一些状态</span><br><span class="line">persist-tun</span><br><span class="line">verb <span class="number">3</span>  #指定日志文件的记录详细级别，可选<span class="number">0</span><span class="number">-9</span>，等级越高日志内容越详细</span><br><span class="line"></span><br><span class="line"><span class="built_in">log</span> /var/<span class="built_in">log</span>/openvpn/server.<span class="built_in">log</span> #指定 <span class="built_in">log</span> 文件位置</span><br><span class="line"><span class="built_in">log</span>-append /var/<span class="built_in">log</span>/openvpn/server.<span class="built_in">log</span></span><br><span class="line">status /var/<span class="built_in">log</span>/openvpn/status.<span class="built_in">log</span></span><br></pre></td></tr></table></figure><h4 id="3-3-3-创建用户密码文件"><a href="#3-3-3-创建用户密码文件" class="headerlink" title="3.3.3 创建用户密码文件"></a>3.3.3 创建用户密码文件</h4><p>格式是<code>用户 密码</code>以空格分割即可，这里将用户名设置为<strong>mytest</strong>，密码设置为<strong>mytestpass</strong>。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">'mytest mytestpass'</span> &gt;&gt; /etc/openvpn/server/user/psw-file</span><br><span class="line">chmod 600 /etc/openvpn/server/user/psw-file</span><br><span class="line">chown openvpn:openvpn /etc/openvpn/server/user/psw-file</span><br></pre></td></tr></table></figure><h4 id="3-3-4-创建密码检查脚本"><a href="#3-3-4-创建密码检查脚本" class="headerlink" title="3.3.4 创建密码检查脚本"></a>3.3.4 创建密码检查脚本</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#新建shell文件</span></span><br><span class="line">vim /etc/openvpn/server/user/checkpsw.sh</span><br><span class="line"></span><br><span class="line"><span class="comment">#在shell文件中写入以下内容</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"></span><br><span class="line">PASSFILE=<span class="string">"/etc/openvpn/server/user/psw-file"</span></span><br><span class="line">LOG_FILE=<span class="string">"/var/log/openvpn/password.log"</span></span><br><span class="line">TIME_STAMP=`date <span class="string">"+%Y-%m-%d %T"</span>`</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ ! -r <span class="string">"<span class="variable">$&#123;PASSFILE&#125;</span>"</span> ]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"<span class="variable">$&#123;TIME_STAMP&#125;</span>: Could not open password file \"<span class="variable">$&#123;PASSFILE&#125;</span>\" for reading."</span> &gt;&gt;  <span class="variable">$&#123;LOG_FILE&#125;</span></span><br><span class="line">  <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">CORRECT_PASSWORD=`awk <span class="string">'!/^;/&amp;&amp;!/^#/&amp;&amp;$1=="'</span><span class="variable">$&#123;username&#125;</span><span class="string">'"&#123;print $2;exit&#125;'</span> <span class="variable">$&#123;PASSFILE&#125;</span>`</span><br><span class="line"><span class="keyword">if</span> [ <span class="string">"<span class="variable">$&#123;CORRECT_PASSWORD&#125;</span>"</span> = <span class="string">""</span> ]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"<span class="variable">$&#123;TIME_STAMP&#125;</span>: User does not exist: username=\"<span class="variable">$&#123;username&#125;</span>\", password=</span></span><br><span class="line"><span class="string">\"<span class="variable">$&#123;password&#125;</span>\"."</span> &gt;&gt; <span class="variable">$&#123;LOG_FILE&#125;</span></span><br><span class="line">  <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">"<span class="variable">$&#123;password&#125;</span>"</span> = <span class="string">"<span class="variable">$&#123;CORRECT_PASSWORD&#125;</span>"</span> ]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"<span class="variable">$&#123;TIME_STAMP&#125;</span>: Successful authentication: username=\"<span class="variable">$&#123;username&#125;</span>\"."</span> &gt;&gt; <span class="variable">$&#123;LOG_FILE&#125;</span></span><br><span class="line">  <span class="built_in">exit</span> 0</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"<span class="variable">$&#123;TIME_STAMP&#125;</span>: Incorrect password: username=\"<span class="variable">$&#123;username&#125;</span>\", password=</span></span><br><span class="line"><span class="string">\"<span class="variable">$&#123;password&#125;</span>\"."</span> &gt;&gt; <span class="variable">$&#123;LOG_FILE&#125;</span></span><br><span class="line"><span class="built_in">exit</span> 1</span><br></pre></td></tr></table></figure><p>赋予可执行的权限</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chmod 700 &#x2F;etc&#x2F;openvpn&#x2F;server&#x2F;user&#x2F;checkpsw.sh</span><br><span class="line">chown openvpn:openvpn &#x2F;etc&#x2F;openvpn&#x2F;server&#x2F;user&#x2F;checkpsw.sh</span><br></pre></td></tr></table></figure><h4 id="3-3-5-防火墙配置"><a href="#3-3-5-防火墙配置" class="headerlink" title="3.3.5 防火墙配置"></a>3.3.5 防火墙配置</h4><ul><li>防火墙</li></ul><p>禁用centos7默认的firewalld，使用iptables防火墙管理软件：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop firewalld</span><br><span class="line">systemctl mask firewalld</span><br></pre></td></tr></table></figure><ul><li>禁用SELinux</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#临时生效</span></span><br><span class="line">setenforce 0</span><br><span class="line"></span><br><span class="line"><span class="comment">#永久关闭，配置后需要重启服务器生效</span></span><br><span class="line">sed -i <span class="string">'s/SELINUX=enforcing/SELINUX=disabled/g'</span> /etc/selinux/config</span><br></pre></td></tr></table></figure><ul><li><p>iptables</p><p>启用iptables</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">yum install iptables-services</span><br><span class="line">systemctl <span class="built_in">enable</span> iptables</span><br><span class="line">systemctl start iptables</span><br><span class="line">iptables -F   <span class="comment"># 清理所有防火墙规则</span></span><br></pre></td></tr></table></figure><p>添加防火墙规则</p><p>将openvpn的网络流量转发到内网（172.31.0.0）</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 如下网段记得与server.conf 当中定义的网段保持一致</span><br><span class="line">iptables -t nat -A POSTROUTING -s 10.8.0.0&#x2F;24 -o eth0 -j MASQUERADE</span><br><span class="line">iptables -L -t nat</span><br><span class="line">iptables-save &gt; &#x2F;etc&#x2F;sysconfig&#x2F;iptables   # iptables 规则持久化保存</span><br></pre></td></tr></table></figure></li></ul><ul><li>Linux服务器启用地址转发</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">vi /etc.sysctl.conf</span><br><span class="line"><span class="comment">#在最后一行添加以下内容</span></span><br><span class="line">net.ipv4.ip_forward = 1</span><br><span class="line"></span><br><span class="line"><span class="comment">#执行生效</span></span><br><span class="line">sysctl -p</span><br></pre></td></tr></table></figure><p>===============================以下是firewalld配置可不看=========================</p><ul><li><p>firewalld</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">yum install -y firewall-<span class="function">cmd <span class="title">config</span>(<span class="params">替换为下一句</span>)</span></span><br><span class="line"><span class="function">yum install -y firewalld firewall-config</span></span><br><span class="line"><span class="function">firewall-cmd --permanent --<span class="keyword">add</span>-masquerade</span></span><br><span class="line"><span class="function">firewall-cmd --permanent --<span class="keyword">add</span>-service</span>=openvpn</span><br><span class="line"><span class="meta"># 或者添加自定义端口</span></span><br><span class="line">firewall-cmd --permanent  --<span class="keyword">add</span>-port=<span class="number">1194</span>/tcp</span><br><span class="line">firewall-cmd --permanent --direct --passthrough ipv4 -t nat -A POSTROUTING -s <span class="number">10.8</span><span class="number">.0</span><span class="number">.0</span>/<span class="number">24</span> -o eth0 -j MASQUERADE</span><br><span class="line">firewall-cmd --reload</span><br></pre></td></tr></table></figure></li></ul><p>注：</p><p>如果执行失败需确认防火墙是否开启。</p><p>1、查看防火墙状态：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl status firewalld</span><br></pre></td></tr></table></figure><p><img src="image-202112101642112212.png" alt="img"></p><p>inactive表示防火墙为关闭状态。</p><p>2、开启防火墙</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start firewalld</span><br></pre></td></tr></table></figure><p><img src="1914529-20200402110749768-1286835379.png" alt="img"></p><p>启动后无任何提示，再次查看防火墙状态，可以看到变成active，成功启动。</p><p>3、关闭防火墙</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop firewalld</span><br></pre></td></tr></table></figure><p>===============================以上是firewalld配置可不看=========================</p><h4 id="3-3-6-启动服务"><a href="#3-3-6-启动服务" class="headerlink" title="3.3.6 启动服务"></a>3.3.6 启动服务</h4><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nohup openvpn /etc/openvpn/server/server.conf &gt;<span class="regexp">/dev/</span><span class="literal">null</span> <span class="number">2</span>&gt;&amp;<span class="number">1</span> &amp;</span><br></pre></td></tr></table></figure><p>启动之后，服务端有一个tun0的网卡，如下</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">tun0: flags=4305&lt;UP,POINTOPOINT,RUNNING,NOARP,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 10.8.0.1  netmask 255.255.255.255  destination 10.8.0.2</span><br><span class="line">        inet6 fe80::10da:ceb2:8a1c:4b4f  prefixlen 64  scopeid 0x20&lt;link&gt;</span><br><span class="line">        unspec 00-00-00-00-00-00-00-00-00-00-00-00-00-00-00-00  txqueuelen 100  (UNSPEC)</span><br><span class="line">        RX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 3  bytes 144 (144.0 B)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br></pre></td></tr></table></figure><p>开机自启动部分待设定</p><h3 id="3-4-配置客户端"><a href="#3-4-配置客户端" class="headerlink" title="3.4 配置客户端"></a>3.4 配置客户端</h3><p>客户端我们同样使用2.4.7的版本，下载连接：</p><p><a href="https://www.techspot.com/downloads/5182-openvpn.html" target="_blank" rel="noopener">https://www.techspot.com/downloads/5182-openvpn.html</a></p><p>因为我们前面配置的是账号密码认证，所以我们只需要下载ca.crt、ta.key文件即可，从server上将生成的<code>ca.crt</code>、<code>ta.key</code>下载到客户端的安装目录 config下。</p><p><code>ca.crt</code>文件路径：/etc/openvpn/server/easy-rsa/pki/ca.crt</p><p><code>ta.key</code>文件路径：/etc/openvpn/server/easy-rsa/ta.key</p><p> 在config目录下新建一个文件 client.ovpn，文件内容如下：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">client</span></span><br><span class="line"><span class="selector-tag">proto</span> <span class="selector-tag">tcp</span></span><br><span class="line"><span class="selector-tag">dev</span> <span class="selector-tag">tun</span></span><br><span class="line"><span class="selector-tag">auth-user-pass</span></span><br><span class="line"><span class="selector-tag">remote</span> <span class="selector-tag">your</span><span class="selector-class">.domain</span><span class="selector-class">.com</span> 1194 </span><br><span class="line"><span class="selector-id">#1194</span>为虚机开放的端口号，与前文中的配置要统一</span><br><span class="line"><span class="selector-id">#your</span><span class="selector-class">.domain</span><span class="selector-class">.com</span>替换为<span class="selector-tag">Linux</span>虚机的域名地址或者是该虚机的公有地址</span><br><span class="line"><span class="selector-tag">ca</span> <span class="selector-tag">ca</span><span class="selector-class">.crt</span></span><br><span class="line"><span class="selector-tag">tls-auth</span> <span class="selector-tag">ta</span><span class="selector-class">.key</span> 1</span><br><span class="line"><span class="selector-tag">remote-cert-tls</span> <span class="selector-tag">server</span></span><br><span class="line"><span class="selector-tag">cipher</span> <span class="selector-tag">AES-256-GCM</span></span><br><span class="line"><span class="selector-tag">auth-nocache</span></span><br><span class="line"><span class="selector-tag">persist-tun</span></span><br><span class="line"><span class="selector-tag">persist-key</span></span><br><span class="line"><span class="selector-tag">compress</span> <span class="selector-tag">lzo</span></span><br><span class="line"><span class="selector-tag">verb</span> 3</span><br><span class="line"><span class="selector-tag">mute</span> 10</span><br></pre></td></tr></table></figure><p><img src="image-202202251425255491.png" alt="image-20220225142525549"></p><p>右键openvpn客户端图标的选项，需确认OpenVPN的设置如下：</p><p><img src="image-20220225143238564.png" alt="image-20220225143238563"></p><p>保存退出之后，我们启动openvpn的客户端，然后输入账号密码即可登录。</p><p><img src="image-202202251427318342.png" alt="image-20220225142731834"></p><p>telnet测试内网连通性</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">telnet 172.31.27.207 22</span><br><span class="line"><span class="comment">#telnet 内网ip 22端口</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        
        
          &lt;h1 id=&quot;OpenVPN使用手册&quot;&gt;&lt;a
        
      
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>S3 跨账号复制</title>
    <link href="http://yoursite.com/2022/03/09/MigrateOfS3/"/>
    <id>http://yoursite.com/2022/03/09/MigrateOfS3/</id>
    <published>2022-03-09T16:00:00.000Z</published>
    <updated>2022-03-09T16:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="场景背景"><a href="#场景背景" class="headerlink" title="场景背景"></a>场景背景</h1><p>公司业务中可能涉及到内部账号之间数据的迁移，那么如何迁移整个 S3 中的数据到另外一个账户可能困扰着我们。今天我们就要教大家怎么实现跨账号的 S3 数据迁移，请准备两个Amazon Web Services 账户，一起开启数据迁移之旅。</p><p>要确保目标账户拥有从另一个账户复制 S3 的对象，请授予目标账户拥有跨账户复制的权限。大致按照以下步骤配置跨账户权限，将对象从账户 A 中的源存储桶复制到账户 B 中的目标存储桶：</p><ul><li>将 <strong>存储桶策略</strong> 附加到账户 A 中的源存储桶。</li><li>将 <strong>Amazon IAM 策略</strong> 附加到账户 B 中的目标用户。</li><li>使用目标账户 B 中的 IAM 用户执行跨账户复制。</li><li>整个存储桶迁移的过程就是从A存储桶迁移到B存储桶的过程</li></ul><p><img src="https://raw.githubusercontent.com/jsabook/githubPic/main/myblog/ABUIABAEGAAgs7LZ-QUojumZxAMwxgU4wQI.png" alt=" "></p><h1 id="步骤一：创建A存储桶"><a href="#步骤一：创建A存储桶" class="headerlink" title="步骤一：创建A存储桶"></a>步骤一：创建A存储桶</h1><p><strong>在账户 A 中创建 S3 存储桶。</strong></p><p>登录账号 A， 点击 <strong>服务</strong>，进入 S3 服务控制台，并选择 <strong>创建存储桶</strong>。</p><p><img src="https://raw.githubusercontent.com/jsabook/githubPic/main/myblog/ABUIABAEGAAgzrLZ-QUo8LPEwgYw3gY49QM.png" alt=" "></p><p><img src="https://raw.githubusercontent.com/jsabook/githubPic/main/myblog/ABUIABAEGAAg3rLZ-QUo4PO5owQwyAY4kAI.png" alt=" "></p><p>接着，设定存储桶的相关配置：</p><ul><li>存储桶名称：请根据需要自行创建一个<strong>全球唯一的存储桶名称</strong>；</li><li>区域：请根据需要自行选择；</li></ul><p>其他配置保持默认，选择创建存储桶；</p><p><img src="https://raw.githubusercontent.com/jsabook/githubPic/main/myblog/ABUIABAEGAAg7rLZ-QUoiJXR2AIwyAY4zgc.png" alt=" "></p><p><img src="https://raw.githubusercontent.com/jsabook/githubPic/main/myblog/ABUIABAEGAAg_LLZ-QUooNz02QYwyAY4sQI.png" alt=" "></p><h1 id="步骤二：A存储桶策略添加"><a href="#步骤二：A存储桶策略添加" class="headerlink" title="步骤二：A存储桶策略添加"></a>步骤二：A存储桶策略添加</h1><p>选择第一步创建的 S3 存储桶，选择 <strong>权限</strong>，向下滚动，找到 <strong>存储桶策略</strong>，点击 <strong>编辑</strong>。</p><p><img src="https://raw.githubusercontent.com/jsabook/githubPic/main/myblog/ABUIABAEGAAgjLPZ-QUo5vW4wgcwyAY4hAc.png" alt=" "></p><p>将以下存储桶策略复制进去，并修改以下相关配置：</p><p><strong>arn:aws:iam::11111111111:user/s3-demo</strong> 替换为<strong>账户 B 中 IAM 用户的 ARN</strong>；</p><p><strong>sourcebucketname</strong> 替换为<strong>在账号 A 中创建的 S3 存储桶名称；</strong></p><p>其他配置保留默认。</p><p><strong>Global区域</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;Version&quot;: &quot;2012-10-17&quot;,</span><br><span class="line">    &quot;Statement&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;Sid&quot;: &quot;DelegateS3Access&quot;,</span><br><span class="line">            &quot;Effect&quot;: &quot;Allow&quot;,</span><br><span class="line">            &quot;Principal&quot;: &#123;</span><br><span class="line">                &quot;AWS&quot;: &quot;arn:aws:iam::11111111111:user&#x2F;s3-demo&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;Action&quot;: [</span><br><span class="line">                &quot;s3:ListBucket&quot;,</span><br><span class="line">                &quot;s3:GetObject&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;Resource&quot;: [</span><br><span class="line">                &quot;arn:aws:s3:::source_bucket_name&#x2F;*&quot;,</span><br><span class="line">                &quot;arn:aws:s3:::source_bucket_name&quot;</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>中国区域</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;Version&quot;: &quot;2012-10-17&quot;,</span><br><span class="line">    &quot;Statement&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;Sid&quot;: &quot;DelegateS3Access&quot;,</span><br><span class="line">            &quot;Effect&quot;: &quot;Allow&quot;,</span><br><span class="line">            &quot;Principal&quot;: &#123;</span><br><span class="line">                 &quot;AWS&quot;: &quot;arn:aws:iam::11111111111:user&#x2F;s3-demo&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;Action&quot;: [</span><br><span class="line">                &quot;s3:ListBucket&quot;,</span><br><span class="line">                &quot;s3:GetObject&quot;,</span><br><span class="line">                &quot;s3:PutObject&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;Resource&quot;: [</span><br><span class="line">                &quot;arn:aws-cn:s3:::sensors2aws&#x2F;*&quot;,</span><br><span class="line">                &quot;arn:aws-cn:s3:::sensors2aws&quot;</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="步骤三：创建B存储桶"><a href="#步骤三：创建B存储桶" class="headerlink" title="步骤三：创建B存储桶"></a>步骤三：创建B存储桶</h1><p><strong>同理，在账号 B 中也创建一个 S3 存储桶，作为目标存储桶。</strong>具体操作过程请参考<strong>创建A存储桶</strong>。</p><p><img src="https://raw.githubusercontent.com/jsabook/githubPic/main/myblog/ABUIABAEGAAgpLPZ-QUolJKjwAIwyAY4wgI.png" alt=" "></p><h1 id="步骤四：B账号添加IAM策略"><a href="#步骤四：B账号添加IAM策略" class="headerlink" title="步骤四：B账号添加IAM策略"></a>步骤四：B账号添加IAM策略</h1><p><strong>在账户 B 中，创建 IAM 客户托管策略。</strong></p><p>点击 <strong>服务</strong>，进入 <strong>IAM 服务控制台</strong>，选择 <strong>策略</strong>，选择 <strong>创建策略</strong>，接着选择 <strong>JSON</strong>；</p><p><img src="https://raw.githubusercontent.com/jsabook/githubPic/main/myblog/ABUIABAEGAAgtLPZ-QUo3Mv34gcwyAY4mQI.png" alt=" "></p><p><img src="https://raw.githubusercontent.com/jsabook/githubPic/main/myblog/ABUIABAEGAAgvLPZ-QUo3r6FowUwyAY4pQM.png" alt=" "></p><p><img src="https://raw.githubusercontent.com/jsabook/githubPic/main/myblog/ABUIABAEGAAgx7PZ-QUo-Mb5wwQwyAY47QI.png" alt=" "></p><p>接着，将以下 IAM 策略复制进去，并修改以下相关配置：</p><p><strong>sourcebucketname</strong> 替换为源存储桶的名称，即在账户 A 中创建的 S3 存储桶名称；</p><p><strong>destinationbucketname</strong> 替换为目标存储桶的名称，即在账户 B 中创建的 S3 存储桶名称。</p><p>这条策略是允许 IAM 用户将对象从账户 A 中的源存储桶复制到账户 B 中的目标存储桶。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;Version&quot;: &quot;2012-10-17&quot;,</span><br><span class="line">    &quot;Statement&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;Effect&quot;: &quot;Allow&quot;,</span><br><span class="line">            &quot;Action&quot;: [</span><br><span class="line">                &quot;s3:ListBucket&quot;,</span><br><span class="line">                &quot;s3:GetObject&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;Resource&quot;: [</span><br><span class="line">                &quot;arn:aws:s3:::source_bucket_name&quot;,</span><br><span class="line">                &quot;arn:aws:s3:::source_bucket_name&#x2F;*&quot;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;Effect&quot;: &quot;Allow&quot;,</span><br><span class="line">            &quot;Action&quot;: [</span><br><span class="line">                &quot;s3:ListBucket&quot;,</span><br><span class="line">                &quot;s3:PutObject&quot;,</span><br><span class="line">                &quot;s3:PutObjectAcl&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;Resource&quot;: [</span><br><span class="line">                &quot;arn:aws:s3:::destination_bucket_name&quot;,</span><br><span class="line">                &quot;arn:aws:s3:::destination_bucket_name&#x2F;*&quot;</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>中国区域</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;Version&quot;: &quot;2012-10-17&quot;,</span><br><span class="line">    &quot;Statement&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;Effect&quot;: &quot;Allow&quot;,</span><br><span class="line">            &quot;Action&quot;: [</span><br><span class="line">                &quot;s3:ListBucket&quot;,</span><br><span class="line">                &quot;s3:GetObject&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;Resource&quot;: [</span><br><span class="line">                &quot;arn:aws-cn:s3:::source_bucket_name&quot;,</span><br><span class="line">                &quot;arn:aws-cn:s3:::source_bucket_name&#x2F;*&quot;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;Effect&quot;: &quot;Allow&quot;,</span><br><span class="line">            &quot;Action&quot;: [</span><br><span class="line">                &quot;s3:ListBucket&quot;,</span><br><span class="line">                &quot;s3:PutObject&quot;,</span><br><span class="line">                &quot;s3:PutObjectAcl&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;Resource&quot;: [</span><br><span class="line">                &quot;arn:aws-cn:s3:::destination_bucket_name&quot;,</span><br><span class="line">                &quot;arn:aws-cn:s3:::destination_bucket_name&#x2F;*&quot;</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>再接着，选择 <strong>查看策略</strong>，输入策略的 <strong>名称和描述</strong>，最后选择 <strong>创建策略</strong>。</p><p><img src="https://raw.githubusercontent.com/jsabook/githubPic/main/myblog/ABUIABAEGAAg47PZ-QUoluKrmQcwyAY4gQQ.png" alt=" "></p><p><img src="https://raw.githubusercontent.com/jsabook/githubPic/main/myblog/ABUIABAEGAAg6rPZ-QUoxPyD4gYwyAY45AI.png" alt=" "></p><h1 id="步骤五：创建B账户的IAM用户"><a href="#步骤五：创建B账户的IAM用户" class="headerlink" title="步骤五：创建B账户的IAM用户"></a><strong>步骤五</strong>：创建B账户的IAM用户</h1><p><strong>在账号 B 中，创建 IAM 用户。并将步骤 4 中的 IAM 策略附加到该用户中[1]。</strong>具体操作步骤可以参考以下官方文档：</p><p>[1] <a href="https://docs.aws.amazon.com/zh_cn/IAM/latest/UserGuide/id_users_create.html" target="_blank" rel="noopener">https://docs.aws.amazon.com/zh_cn/IAM/latest/UserGuide/id_users_create.html</a></p><p>注意：请把用户的访问密钥（访问密钥 ID 和秘密访问密钥）下载下来，后续会用到。</p><h1 id="步骤六：本地安装CLI工具"><a href="#步骤六：本地安装CLI工具" class="headerlink" title="步骤六：本地安装CLI工具"></a>步骤六：本地安装CLI工具</h1><p><strong>在本地电脑安装AWS CLI 工具[2]，并配置账号 B 的访问密钥[3]。</strong></p><p>具体操作步骤可以参考以下官方文档：</p><p>[2] <a href="https://docs.aws.amazon.com/zh_cn/cli/latest/userguide/cli-chap-install.html" target="_blank" rel="noopener">https://docs.aws.amazon.com/zh_cn/cli/latest/userguide/cli-chap-install.html</a></p><p>[3] <a href="https://docs.aws.amazon.com/zh_cn/cli/latest/userguide/cli-chap-configure.html" target="_blank" rel="noopener">https://docs.aws.amazon.com/zh_cn/cli/latest/userguide/cli-chap-configure.html</a></p><h1 id="步骤七：测试跨账号复制"><a href="#步骤七：测试跨账号复制" class="headerlink" title="步骤七：测试跨账号复制"></a>步骤七：测试跨账号复制</h1><p>请在账号 A 的存储桶上传一个文件，并在账户 B 中的 IAM 用户可以使用 AWS 命令行界面 (AWS CLI) 运行 sync 命令：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aws s3 sync s3:&#x2F;&#x2F;source_bucket_name   s3:&#x2F;&#x2F;destination_bucket_name</span><br></pre></td></tr></table></figure><p>并修改以下相关配置：</p><p><strong>sourcebucketname</strong> 替换为源存储桶的名称，即在账户 A 中创建的 S3 存储桶名称；</p><p><strong>destinationbucketname</strong> 替换为目标存储桶的名称，即在账户 B 中创建的 S3 存储桶名称。</p><p><strong>原始地址</strong>：</p><p><a href="https://www.ecloudrover.com/h-nd-112.html" target="_blank" rel="noopener">https://www.ecloudrover.com/h-nd-112.html</a></p>]]></content>
    
    <summary type="html">
    
      
      
        
        
          &lt;h1 id=&quot;场景背景&quot;&gt;&lt;a href=&quot;#场景背景&quot;
        
      
    
    </summary>
    
    
      <category term="迁移" scheme="http://yoursite.com/categories/%E8%BF%81%E7%A7%BB/"/>
    
    
      <category term="AWS" scheme="http://yoursite.com/tags/AWS/"/>
    
      <category term="AWS S3" scheme="http://yoursite.com/tags/AWS-S3/"/>
    
      <category term="migrate" scheme="http://yoursite.com/tags/migrate/"/>
    
      <category term="转载" scheme="http://yoursite.com/tags/%E8%BD%AC%E8%BD%BD/"/>
    
  </entry>
  
  <entry>
    <title>Cloudendure原理</title>
    <link href="http://yoursite.com/2022/03/06/CloudendureOfAws/"/>
    <id>http://yoursite.com/2022/03/06/CloudendureOfAws/</id>
    <published>2022-03-06T16:00:00.000Z</published>
    <updated>2022-03-06T16:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="迁移初始化流程"><a href="#迁移初始化流程" class="headerlink" title="迁移初始化流程"></a>迁移初始化流程</h1><p>cloudendure进行初始化同步时候所经历的操作。初始化需要进行哪些操作，如下图所示：<br><img src="https://raw.githubusercontent.com/jsabook/githubPic/main/myblog/20210307023723369.png" alt="在这里插入图片描述"></p><p>一共分为两部分。即cloudendure 对接公网迁移与对接内网迁移同步</p><h2 id="公网迁移"><a href="#公网迁移" class="headerlink" title="公网迁移"></a>公网迁移</h2><p>源主机与cloudendure console 进行交互,cloudendure console告诉aws,相关<br><img src="https://raw.githubusercontent.com/jsabook/githubPic/main/myblog/20210307023837869.png" alt="在这里插入图片描述"></p><h2 id="客户私有网络"><a href="#客户私有网络" class="headerlink" title="客户私有网络"></a>客户私有网络</h2><h3 id="客户私有网络对接aws私有网络"><a href="#客户私有网络对接aws私有网络" class="headerlink" title="客户私有网络对接aws私有网络"></a>客户私有网络对接aws私有网络</h3><p><img src="https://raw.githubusercontent.com/jsabook/githubPic/main/myblog/2021030702400835.png" alt=""></p><h3 id="客户私有网络对接aws公有网络（红色线）"><a href="#客户私有网络对接aws公有网络（红色线）" class="headerlink" title="客户私有网络对接aws公有网络（红色线）"></a>客户私有网络对接aws公有网络（红色线）</h3><p><img src="https://raw.githubusercontent.com/jsabook/githubPic/main/myblog/20210307024051932.png" alt="在这里插入图片描述"></p><h1 id="Cloudendure使用"><a href="#Cloudendure使用" class="headerlink" title="Cloudendure使用"></a>Cloudendure使用</h1><p>在IDC环境中，将SSM Agent安装到对应主机，并通过Cloudendure进行迁移。迁移完毕之后使用SSM进行连接克隆机，对克隆机进行操作</p><h1 id="Window环境"><a href="#Window环境" class="headerlink" title="Window环境"></a>Window环境</h1><h2 id="安装SSM-agent"><a href="#安装SSM-agent" class="headerlink" title="安装SSM agent"></a>安装SSM agent</h2><p>在本地IDC环境中，给主机安装SSM Agent<br><img src="https://raw.githubusercontent.com/jsabook/githubPic/main/myblog/20210319143139432.png" alt="在这里插入图片描述"></p><p>将软件上传上去，双击执行安装</p><h2 id="进行Cloudendure迁移"><a href="#进行Cloudendure迁移" class="headerlink" title="进行Cloudendure迁移"></a>进行Cloudendure迁移</h2><p>选择role<br><img src="https://raw.githubusercontent.com/jsabook/githubPic/main/myblog/20210319143231995.png" alt="在这里插入图片描述"></p><p>role附加的策略<br><img src="https://raw.githubusercontent.com/jsabook/githubPic/main/myblog/20210319143240481.png" alt=""></p><p>等待迁移成功<br><img src="https://raw.githubusercontent.com/jsabook/githubPic/main/myblog/20210319143249889.png" alt="在这里插入图片描述"></p><h2 id="Cloudendure-Test测试"><a href="#Cloudendure-Test测试" class="headerlink" title="Cloudendure Test测试"></a>Cloudendure Test测试</h2><p><img src="https://raw.githubusercontent.com/jsabook/githubPic/main/myblog/202103191433000.png" alt="在这里插入图片描述"></p><p>克隆机迁移成功<br><img src="https://raw.githubusercontent.com/jsabook/githubPic/main/myblog/20210319143328821.png" alt="在这里插入图片描述"></p><h2 id="使用SSM-连接克隆机"><a href="#使用SSM-连接克隆机" class="headerlink" title="使用SSM 连接克隆机"></a>使用SSM 连接克隆机</h2><p>这里使用SSM连接克隆机，执行一个简单的Powershell命令</p><p>选择AWS-RunPowershell命令</p><p>设置命令参数</p><p><img src="https://raw.githubusercontent.com/jsabook/githubPic/main/myblog/20210319143340189.png" alt="在这里插入图片描述"></p><p>选择实例</p><p>![[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传<img src="https://raw.githubusercontent.com/jsabook/githubPic/main/myblog/2021031914335886.png" alt=""></p><p>输出</p><p>![[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传<img src="https://raw.githubusercontent.com/jsabook/githubPic/main/myblog/20210319143417132.png" alt=""></p><h1 id="Linux环境"><a href="#Linux环境" class="headerlink" title="Linux环境"></a>Linux环境</h1><h2 id="安装SSM-Agent"><a href="#安装SSM-Agent" class="headerlink" title="安装SSM Agent"></a>安装SSM Agent</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget https://s3.cn-north-1.amazonaws.com.cn/amazon-ssm-cn-north-1/latest/linux_amd64/amazon-ssm-agent.rpm</span><br><span class="line">rpm -ivh amazon-ssm-agent.rpm</span><br><span class="line">systemctl <span class="built_in">enable</span> amazon-ssm-agent</span><br></pre></td></tr></table></figure><h2 id="进行迁移"><a href="#进行迁移" class="headerlink" title="进行迁移"></a>进行迁移</h2><p>迁移的时候需要进行设置，选择IAM <img src="https://raw.githubusercontent.com/jsabook/githubPic/main/myblog/20210319143430293.png" alt="在这里插入图片描述"><br>IAM需要具备SSM权限<br><img src="https://raw.githubusercontent.com/jsabook/githubPic/main/myblog/20210319143442653.png" alt="在这里插入图片描述"></p><p>开始迁移<br><img src="https://raw.githubusercontent.com/jsabook/githubPic/main/myblog/20210319143500889.png" alt="在这里插入图片描述"></p><p>等待迁移完毕<br><img src="https://raw.githubusercontent.com/jsabook/githubPic/main/myblog/20210319143523638.png" alt="在这里插入图片描述"></p><h2 id="使用SSM进行连接"><a href="#使用SSM进行连接" class="headerlink" title="使用SSM进行连接"></a>使用SSM进行连接</h2><p>使用SSM进行连接，进行简单的测试。</p><p>选择AWS-RunShellScript操作，编写命令参数</p><p><img src="https://raw.githubusercontent.com/jsabook/githubPic/main/myblog/20210319143534251.png" alt="在这里插入图片描述"></p><p>选择实例</p><p><img src="https://raw.githubusercontent.com/jsabook/githubPic/main/myblog/2021031914354231.png" alt="在这里插入图片描述"></p><p>运行命令，查看输出<br><img src="https://raw.githubusercontent.com/jsabook/githubPic/main/myblog/20210319143605629.png" alt="在这里插入图片描述"></p>]]></content>
    
    <summary type="html">
    
      
      
        
        
          &lt;h1 id=&quot;迁移初始化流程&quot;&gt;&lt;a
        
      
    
    </summary>
    
    
      <category term="迁移" scheme="http://yoursite.com/categories/%E8%BF%81%E7%A7%BB/"/>
    
    
      <category term="AWS" scheme="http://yoursite.com/tags/AWS/"/>
    
  </entry>
  
  <entry>
    <title>SIEM on Amazon OpenSearch Service</title>
    <link href="http://yoursite.com/2022/03/02/SIEMonAmazonOpenSearchService/"/>
    <id>http://yoursite.com/2022/03/02/SIEMonAmazonOpenSearchService/</id>
    <published>2022-03-02T16:00:00.000Z</published>
    <updated>2022-03-02T16:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="架构"><a href="#架构" class="headerlink" title="架构"></a>架构</h1><p><img src="https://raw.githubusercontent.com/jsabook/githubPic/main/myblog/image-20220303100505518.png" alt="image-20220303100505518"></p><p>核心代码是中间的ETL Lambda，通过这个Lambda来对各种日志进行ETL处理。</p><h1 id="支持日志"><a href="#支持日志" class="headerlink" title="支持日志"></a>支持日志</h1><p><img src="https://raw.githubusercontent.com/jsabook/githubPic/main/myblog/image-20220303102525168.png" alt="image-20220303102525168"></p><p><strong>dashboard</strong>展示</p><p><a href="https://github.com/aws-samples/siem-on-amazon-opensearch-service/blob/main/docs/dashboard.md" target="_blank" rel="noopener">dashboard展示</a></p><p><img src="https://raw.githubusercontent.com/jsabook/githubPic/main/myblog/image-20220303102547395.png" alt="image-20220303102547395"></p><p><img src="https://raw.githubusercontent.com/jsabook/githubPic/main/myblog/image-20220303102605583.png" alt="image-20220303102605583"></p>]]></content>
    
    <summary type="html">
    
      
      
        
        
          &lt;h1 id=&quot;架构&quot;&gt;&lt;a href=&quot;#架构&quot;
        
      
    
    </summary>
    
    
      <category term="SIEM" scheme="http://yoursite.com/categories/SIEM/"/>
    
    
      <category term="AWS 日志分析" scheme="http://yoursite.com/tags/AWS-%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90/"/>
    
  </entry>
  
  <entry>
    <title>Gitlab CICD</title>
    <link href="http://yoursite.com/2022/02/28/GitlabCICD/"/>
    <id>http://yoursite.com/2022/02/28/GitlabCICD/</id>
    <published>2022-02-28T16:00:00.000Z</published>
    <updated>2022-02-28T16:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="关键词"><a href="#关键词" class="headerlink" title="关键词"></a>关键词</h1><h3 id="Pipeline"><a href="#Pipeline" class="headerlink" title="Pipeline"></a><strong>Pipeline</strong></h3><p>Pipeline执行的过程就是一次执行Stage中的列表流程的阶段。</p><h3 id="Stages"><a href="#Stages" class="headerlink" title="Stages"></a><strong>Stages</strong></h3><p>默认的Stage</p><p>Gitlab的Pipeline有一个默认的Stages流程，如果ci文件中没有存在的Stages阶段，则会使用官方提供的Stages阶段。Gitlab CICD的pipeline有一个默认的stages即下列阶段。</p><ul><li>.pre</li><li>build</li><li>test</li><li>deploy</li></ul><p>多个任务可以分配给同一个Stage。而分配给同一个Stage的任务是并行执行的。</p><p><img src="https://raw.githubusercontent.com/jsabook/githubPic/main/myblog/image-20220301110307460.png" alt="image-20220301110307460"></p><p>其中的job3与jib4按照理论就是并行执行的。</p><p>可以定义自己的stages流程。如下图</p><p><img src="https://raw.githubusercontent.com/jsabook/githubPic/main/myblog/image-20220301110823693.png" alt="image-20220301110823693"></p><p>如图所示job3与job4都分配给了stage3.</p><p>运行结果</p><p><img src="https://raw.githubusercontent.com/jsabook/githubPic/main/myblog/image-20220301110856746.png" alt="image-20220301110856746"></p><p><strong>Script</strong></p><p>所有的job都需要有这么一个关键词。script就是执行Linux命令</p><p>下图显示了如何使用script执行Linux命令</p><p><img src="https://raw.githubusercontent.com/jsabook/githubPic/main/myblog/image-20220301111235615.png" alt="image-20220301111235615"></p><p><img src="https://raw.githubusercontent.com/jsabook/githubPic/main/myblog/image-20220301111306218.png" alt="image-20220301111306218"></p><p><strong>retry</strong></p><p>运行失败，重新运行几遍.一般取值为3</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">test:</span><br><span class="line">  script: respc</span><br><span class="line">  retry: 2</span><br></pre></td></tr></table></figure><p>或者指定失败原因，当这个失败原因的时候才回去触发重试机制</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">test:</span><br><span class="line">  script: respc</span><br><span class="line">  retry: </span><br><span class="line">    max: 2</span><br><span class="line">    when: runner_system_failure</span><br></pre></td></tr></table></figure><p>失败原因 列表 todo</p><p><strong>when</strong></p><p>发生故障或者经过故障仍然能够运行的作业</p><p><strong>only</strong></p><p>指定分支，only/except 是规定当前job的可见状态，一个项目有很多分支，tag，我们的流水线，为了对特定的分支，特定的tag执行不同的job，这里就要使用only和except 在任务上加上这一段代码，就表明当前任务只有在master分支可以运行。</p><h3 id="cache"><a href="#cache" class="headerlink" title="cache"></a><strong>cache</strong></h3><p>缓存是将当前工作环境目录中的一些文件，一些文件夹存储起来，用于在各个任务初始化的时候恢复。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cache:</span><br><span class="line">  key: hello-vue-cache</span><br><span class="line">  path:</span><br><span class="line">    - node_modules</span><br></pre></td></tr></table></figure><p>在其他任务启动的时候就会恢复这个缓存目录，并不会讲缓存目录删除掉。如果没有缓存，则等待任务结束会将产生的文件删除掉。</p><h3 id="image"><a href="#image" class="headerlink" title="image"></a>image</h3><p>image 是全局关键词可以在全局层面设置image镜像之后，在单独的job任务中也设置镜像。由于每个服务是单独的，也和前面的cache关键词对应起来。</p><h1 id="注入变量"><a href="#注入变量" class="headerlink" title="注入变量"></a>注入变量</h1><ul><li>gitlab-ci.yml中自己定义</li><li>pipeline中预定义的变量<ul><li>在这个网址中进行查询<a href="https://docs.gitlab.com/ee/ci/variables/predefined_variables.html" target="_blank" rel="noopener">https://docs.gitlab.com/ee/ci/variables/predefined_variables.html</a></li></ul></li><li>在项目中设置变量</li></ul><p><strong>gitlab-ci.yml中自己定义</strong></p><p>全局变量</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">variables:</span><br><span class="line">  MT_VAR: &quot;All jobs can use this variable&#96;s value&quot;</span><br><span class="line">logs_var:</span><br><span class="line">  script:</span><br><span class="line">    - echo $MT_VAR</span><br><span class="line">job_deploy:</span><br><span class="line">  variables:</span><br><span class="line">    imgname: &quot;name2&quot;</span><br><span class="line">    containername: &quot;name1&quot;</span><br><span class="line">  script:</span><br><span class="line">    - docker build -t $imgname</span><br></pre></td></tr></table></figure><p>如何查看pipeline中预定义的变量</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">get_all_var:</span><br><span class="line">  scropt:</span><br><span class="line">    - export</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        
        
          &lt;h1 id=&quot;关键词&quot;&gt;&lt;a href=&quot;#关键词&quot;
        
      
    
    </summary>
    
    
      <category term="gitlab" scheme="http://yoursite.com/categories/gitlab/"/>
    
    
      <category term="gitlab" scheme="http://yoursite.com/tags/gitlab/"/>
    
      <category term="CICD" scheme="http://yoursite.com/tags/CICD/"/>
    
  </entry>
  
  <entry>
    <title>AWS使用SSM</title>
    <link href="http://yoursite.com/2022/02/16/SSMUse/"/>
    <id>http://yoursite.com/2022/02/16/SSMUse/</id>
    <published>2022-02-16T16:00:00.000Z</published>
    <updated>2022-02-27T16:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="创建Role所需的的Policy"><a href="#创建Role所需的的Policy" class="headerlink" title="创建Role所需的的Policy"></a>创建Role所需的的Policy</h1><h2 id="创建Role-选定EC2。"><a href="#创建Role-选定EC2。" class="headerlink" title="创建Role,选定EC2。"></a><strong>创建Role,选定EC2。</strong></h2><p><img src="https://raw.githubusercontent.com/jsabook/githubPic/main/myblog/image-20220228110527044.png" alt="image-20220228110527044"></p><h2 id="选定策略"><a href="#选定策略" class="headerlink" title="选定策略"></a><strong>选定策略</strong></h2><p>关于策略说明</p><p>基础策略：<strong>AmazonSSMManagedInstanceCore</strong></p><p>其他策略：</p><ul><li><strong>AmazonSSMDirectoryServiceAccess</strong>：将 Windows Server 的 Amazon EC2 实例加入 Microsoft AD 目录时才需要。</li><li><strong>CloudWatchAgentServerPolicy</strong>：仅当计划在实例上安装和运行 CloudWatch 代理以读取实例上的指标和日志数据并将其写入 Amazon CloudWatch 时才需要。</li></ul><p>这里选择<strong>AmazonSSMManagedInstanceCore</strong>策略即可。</p><p><img src="https://raw.githubusercontent.com/jsabook/githubPic/main/myblog/image-20220228110900103.png" alt="image-20220228110900103"></p><h2 id="名称设置，然后创建角色"><a href="#名称设置，然后创建角色" class="headerlink" title="名称设置，然后创建角色"></a>名称设置，然后创建角色</h2><p><img src="https://raw.githubusercontent.com/jsabook/githubPic/main/myblog/image-20220228111304095.png" alt="image-20220228111304095"></p><h1 id="将Role-Attach到EC2"><a href="#将Role-Attach到EC2" class="headerlink" title="将Role Attach到EC2"></a>将Role Attach到EC2</h1><p>选择修改IAM角色</p><p><img src="https://raw.githubusercontent.com/jsabook/githubPic/main/myblog/image-20220228112047277.png" alt="image-20220228112047277"></p><h1 id="SSM-运行"><a href="#SSM-运行" class="headerlink" title="SSM 运行"></a>SSM 运行</h1><h2 id="运行脚本"><a href="#运行脚本" class="headerlink" title="运行脚本"></a>运行脚本</h2><p><strong>选择SSM的运行命令</strong></p><p><img src="https://raw.githubusercontent.com/jsabook/githubPic/main/myblog/image-20220228112200468.png" alt="image-20220228112200468"></p><p><strong>选择Shell脚本运行</strong></p><p><img src="https://raw.githubusercontent.com/jsabook/githubPic/main/myblog/image-20220228112334472.png" alt="image-20220228112334472"></p><p><strong>运行命令</strong></p><p><img src="https://raw.githubusercontent.com/jsabook/githubPic/main/myblog/image-20220228113101896.png" alt="image-20220228113101896"></p><p><strong>写入命令</strong></p><p><img src="https://raw.githubusercontent.com/jsabook/githubPic/main/myblog/image-20220228113207080.png" alt="image-20220228113207080"></p><p><strong>目标选择</strong></p><p>这里选择手动选择实例</p><p><img src="https://raw.githubusercontent.com/jsabook/githubPic/main/myblog/image-20220228113332954.png" alt="image-20220228113332954"></p><p><strong>运行命令，查看结果</strong></p><h2 id="会话管理器"><a href="#会话管理器" class="headerlink" title="会话管理器"></a>会话管理器</h2><p><img src="https://raw.githubusercontent.com/jsabook/githubPic/main/myblog/image-20220228134314065.png" alt="image-20220228134314065"></p><p><strong>连接使用</strong></p><p><img src="https://raw.githubusercontent.com/jsabook/githubPic/main/myblog/image-20220228134418778.png" alt="image-20220228134418778"></p>]]></content>
    
    <summary type="html">
    
      
      
        
        
          &lt;h1 id=&quot;创建Role所需的的Policy&quot;&gt;&lt;a
        
      
    
    </summary>
    
    
      <category term="EC2" scheme="http://yoursite.com/categories/EC2/"/>
    
    
      <category term="EC2" scheme="http://yoursite.com/tags/EC2/"/>
    
  </entry>
  
  <entry>
    <title>AWS的资费</title>
    <link href="http://yoursite.com/2022/02/15/BillingOfAWS-test/"/>
    <id>http://yoursite.com/2022/02/15/BillingOfAWS-test/</id>
    <published>2022-02-15T16:00:00.000Z</published>
    <updated>2022-02-15T16:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="EC2收费"><a href="#EC2收费" class="headerlink" title="EC2收费"></a>EC2收费</h1><table><thead><tr><th>收费名称</th><th>含义</th><th>备注</th></tr></thead><tbody><tr><td>Amazon Elastic Compute Cloud NatGateway</td><td>Nat网关费用</td><td>$0.059 per NAT Gateway Hour</td></tr><tr><td>Amazon Elastic Compute Cloud running</td><td>EC2费用</td><td></td></tr><tr><td>EBS</td><td>EBS卷费用</td><td></td></tr><tr><td></td><td></td><td></td></tr></tbody></table><h1 id="RDS费用"><a href="#RDS费用" class="headerlink" title="RDS费用"></a>RDS费用</h1><table><thead><tr><th>收费名称</th><th>含义</th><th>备注</th></tr></thead><tbody><tr><td>Amazon Relational Database Service Backup Storage</td><td>备份存储费用（快照）</td><td>USD 0.095 per GB-month of backup storage exceeding free allocation</td></tr><tr><td>Amazon Relational Database Service</td><td>数据库实例费用</td><td>按照实例规格每小时收费，与EC2费用相同</td></tr><tr><td>Amazon Relational Database Service Provisioned Storage</td><td>预置IOPS费用</td><td>极其昂贵</td></tr></tbody></table>]]></content>
    
    <summary type="html">
    
      
      
        
        
          &lt;h1 id=&quot;EC2收费&quot;&gt;&lt;a href=&quot;#EC2收费&quot;
        
      
    
    </summary>
    
    
      <category term="Billing" scheme="http://yoursite.com/categories/Billing/"/>
    
    
      <category term="EC2" scheme="http://yoursite.com/tags/EC2/"/>
    
      <category term="RDS" scheme="http://yoursite.com/tags/RDS/"/>
    
      <category term="EBS" scheme="http://yoursite.com/tags/EBS/"/>
    
  </entry>
  
  <entry>
    <title>AWS的资费</title>
    <link href="http://yoursite.com/2022/02/15/BillingOfAWS/"/>
    <id>http://yoursite.com/2022/02/15/BillingOfAWS/</id>
    <published>2022-02-15T16:00:00.000Z</published>
    <updated>2022-02-15T16:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="EC2收费"><a href="#EC2收费" class="headerlink" title="EC2收费"></a>EC2收费</h1><table><thead><tr><th>收费名称</th><th>含义</th><th>备注</th></tr></thead><tbody><tr><td>Amazon Elastic Compute Cloud NatGateway</td><td>Nat网关费用</td><td>$0.059 per NAT Gateway Hour</td></tr><tr><td>Amazon Elastic Compute Cloud running</td><td>EC2费用</td><td></td></tr><tr><td>EBS</td><td>EBS卷费用</td><td></td></tr><tr><td></td><td></td><td></td></tr></tbody></table><h1 id="RDS费用"><a href="#RDS费用" class="headerlink" title="RDS费用"></a>RDS费用</h1><table><thead><tr><th>收费名称</th><th>含义</th><th>备注</th></tr></thead><tbody><tr><td>Amazon Relational Database Service Backup Storage</td><td>备份存储费用（快照）</td><td>USD 0.095 per GB-month of backup storage exceeding free allocation</td></tr><tr><td>Amazon Relational Database Service</td><td>数据库实例费用</td><td>按照实例规格每小时收费，与EC2费用相同</td></tr><tr><td>Amazon Relational Database Service Provisioned Storage</td><td>预置IOPS费用</td><td>极其昂贵</td></tr></tbody></table>]]></content>
    
    <summary type="html">
    
      
      
        
        
          &lt;h1 id=&quot;EC2收费&quot;&gt;&lt;a href=&quot;#EC2收费&quot;
        
      
    
    </summary>
    
    
      <category term="Billing" scheme="http://yoursite.com/categories/Billing/"/>
    
    
      <category term="EC2" scheme="http://yoursite.com/tags/EC2/"/>
    
      <category term="RDS" scheme="http://yoursite.com/tags/RDS/"/>
    
      <category term="EBS" scheme="http://yoursite.com/tags/EBS/"/>
    
  </entry>
  
  <entry>
    <title>AWS的IOPS</title>
    <link href="http://yoursite.com/2022/02/13/IopsOfAWS/"/>
    <id>http://yoursite.com/2022/02/13/IopsOfAWS/</id>
    <published>2022-02-13T16:00:00.000Z</published>
    <updated>2022-02-13T16:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="IOPS介绍"><a href="#IOPS介绍" class="headerlink" title="IOPS介绍"></a>IOPS介绍</h1><p>IOPS(Input/Output Per Second) 每秒的读写次数，是衡量磁盘性能的主要指标之一。IOPS是指单位时间内系统能够处理的I/O请求数量。也就是讲的是单位时间内，磁盘能够进行多少次的I/O读写。</p><p><strong>Random Read IOPS，100%随机读负载情况下的IOPS</strong></p><p>默认为4k大小的数据块</p><h2 id="读写性能介绍"><a href="#读写性能介绍" class="headerlink" title="读写性能介绍"></a><strong>读写性能介绍</strong></h2><p>硬盘的读写性能又称为数据吞吐量(Throughput)，指的是单位时间内可以成功传输的数据数量。对于大量顺序读写的应用，如VOD，则更关注吞吐量指标。简单来讲，就是每秒磁盘I/O的流量。即磁盘写入加上磁盘读出的数据的大小。</p><h2 id="IOPS与吞吐量的关系"><a href="#IOPS与吞吐量的关系" class="headerlink" title="IOPS与吞吐量的关系"></a>IOPS与吞吐量的关系</h2><p>IOPS = </p>]]></content>
    
    <summary type="html">
    
      
      
        
        
          &lt;h1 id=&quot;IOPS介绍&quot;&gt;&lt;a
        
      
    
    </summary>
    
    
      <category term="EC2" scheme="http://yoursite.com/categories/EC2/"/>
    
    
      <category term="EC2" scheme="http://yoursite.com/tags/EC2/"/>
    
      <category term="RDS" scheme="http://yoursite.com/tags/RDS/"/>
    
      <category term="EBS" scheme="http://yoursite.com/tags/EBS/"/>
    
  </entry>
  
</feed>
